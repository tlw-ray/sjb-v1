# 开发日志

作者: 唐力伟

邮箱: tlw_ray@163.com

## 技术框架

* 后端环境
    - JDK8+
    - SpringBoot2+
        - Security
        - Web
        - WebSocket
            - SockJS
                - Stomp
    - mongoDB
* 前段环境
    - Html5
        - JQuery3.1
        - SockJS
        - BootStrap
    - VUE
    - 微信
        - 公众号
        - 小程序
* 开发环境
    - Intellij Idea64 2018.2
    - Gradle
    
* 版本控制:
    - Github: http://github.com/xskr/sjb-v1
    
## 问题
- IDEA在Gradle项目下未能拷贝源码目录下的*.properties到编译的输出路径;所以暂时去掉Properties文件。
- *.properties实现的多语言，在Docker的java官方镜像上会导致抛出抛出ClassNotDefException异常导致类无法加载的问题，所以暂时去掉Properties文件。
- 服务端客户端传递用户信息应该用房间内座位号。
- Room类较大600+行，应收缩或拆分代码
- 玩家与房间的关系内是全局的，加入别的房间时，应退出当前房间。
- 更高层次的抽象，不同游戏具有相同或类似的房间概念。
- SpringBoot的SLF4j日志库默认没有输出方法名，希望知道是哪个方法的日志。
- 提供微信客户端
- 登录应采用无Session技术
- 想换一套更精简的技术框架比如嵌入式Tomcat+WebSocket框架
- TODO 如果清空了消息记录，或者断线重连后，需要再次查看关键信息。
- TODO 所有的消息结构化
- 转到VUE前端框架
- 游戏辅助决策分析
- 预言家选择看玩家牌
- 操作改为单张操作
- 增加查看关键动作功能
- 判赢功能的结构化输出
- 改进前后端通讯协议
- 增加断线重连
- 独狼时查看牌库中的牌如果看到狼可以再看一张
- 增加事件系统，能够回溯
- 所有玩家都点ready后，提供5秒倒数时间，供放弃（鸡肋的功能)
- ！！！在一局结束时设定房间人数和卡牌设定，好让玩家加入。
- 增加OB功能，可以别人随时加入观战，也可以玩家换座位先切入到OB位。
- 当独狼看底牌看到狼时可以再看一张。该功能会使游戏流程变得过于复杂，需要在夜间行动完毕后独立询问独狼。需要考虑一下再添加。
- 化身幽灵身份加入
- 界面加入
- 集成入微信小程序
- 动态设定房间参数
- 换座位并发问题
- 换座位和OB功能
- 
- 复盘
- 重构，一些属性挂到Player下面
- 增加弃权和不能投自己功能
- 消息的提示内容可以做到前端，网络上只传递消息和参数
- 
## 开发日志
* 20180924: 实现动态更改房间卡牌配置
* 20180923: 根据新框架重构结构
* 20180922: 整理框架，同步请求，异步推送。广播和点对点两种方式。
* 20180921: 换座位功能出现bug，没有做消息同步导致死循环。
* 20180920: 思考能否完全以消息机制来做这个程序，使之具有完全的动态性和即时性。结论：缺少好的框架代码量大，灵活性的提升难度高，推送消息压力大。所以还是要80%基于传统方式，只有极少数推送功能。
            安装微信小程序开发环境，大致了一下微信小程序的开发。基本实现全触屏操作。
* 20180919: 继续实现基于前端操作的后台响应，去掉前台所有的按钮，全触屏操作。
* 20180918: 编写内网Docker部署脚本。周源广给加了一点界面元素，于洋提供了一版界面设计，去掉多余的按钮。修改后台为响应前台操作的设计，而不是前台业务的设计。
* 20180917: 直接移植到VUE上比较麻烦，还是先完善第一版。明天发布进入内测阶段。修正了大部分的小bug。添加断线重连，添加关键消息，添加个人标记。
* 20180916: 建立VUE框架的前端项目，编写了一些VUE的示例，见https://github.com/tlw-ray/runoob-vue。
* 20180915: 调研微信第三方授权用户名和头像的使用，发现只有小程序和企业号才能具有此功能。于是计划使用支付宝的类似功能，好像只要有证书就可以。
* 20180914: 开发WebSocket的点对点功能，并实现了单独例子。另外多房间时游戏逻辑内似乎不存在真正的广播，只有系统实时通告才需要广播，于是计划使用点对点模式做所有的推送。初步完成一个粗糙的前端。
* 20180913: 开始开发带有流程的页面，发现仅仅WebSocket广播难以实现良好的点对点消息推送。广播通过路径过滤，但实际上消息还是发往了每个客户端。
* 20180912: HttpClient似乎不支持WebSocket，另外发现如果只是测试功能的话两个玩家就可。所以通过开启FireFox和Chrome就可以达到测试目的。
* 20180911: 由于该游戏需要多个用户同时进行测试，浏览器开多个客户端会比较麻烦（后来得知Chrom具有模拟多用户功能），于是开发了JavaFX的窗体应用，通过HttpClient模拟多客户端
* 20180910: 开发前端功能，通过一个页面将所有功能加入供测试用
* 20180909: 测试并完善后端逻辑，增加猎人逻辑。
* 20180908: 测试并完善后端逻辑。搭建VUE的前端脚手架。
* 20180907: 开发一夜狼人杀的功能列表测试页面，连接前后端RESTful接口。        
* 20180906: 开发一夜狼人杀的主要逻辑包。
* 20180905: 试图添加独立的房间Room概念，由于该功能次要且抽象为较快出效果，先开发一夜狼人杀游戏，再抽象Room概念。
* 20180904: 调整猜拳游戏规则为实时判赢，玩家存在超时未出的放弃状态。创建项目Readme.md。
* 20180903: 增加玩家猜拳统计和胜平负统计功能。
* 20180902: 调整猜拳功能的bug。
* 20180831: 解决WebSocket， Login等功能。通过Docker技术发布到远端服务器。
* 20180830: 创建并提交石头剪刀布项目，为开发一款具备人工智能特性的多人桌游平台。从最简单规则的博弈游戏石头剪刀布入手。

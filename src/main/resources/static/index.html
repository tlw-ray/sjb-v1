<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>创建或加入房间</title>
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script>
        $(document).ready(function(){
            //创建房间
            $('#create_room_button').click(function(){
                console.log('create')
                $('#create_room_div').show()
                $('#join_room_div').hide()
            })
            //加入房间
            $('#join_room_button').click(function(){
                $('#create_room_div').hide()
                $('#join_room_div').show()
            })
            //创建时勾选
            $('#create_room_div :checkbox').click(function(){
                var size = $('#create_room_div input:checked').length
                $('#apply_create_button').html('(人数:' + size + ') 确定')
                $('#create_room_div').show()
            })
            //确定创建
            $('#apply_create_button').click(function(){
                $('#create_join_div').hide()
                $('#room_div').show()
                var selectedCharacter = $("#create_room_div input:checked").map(function(){return this.value}).get()
                var stringify = JSON.stringify(selectedCharacter)
                $.ajax({
                    url:'/onk/room',
                    type: 'POST',
                    data: stringify,
                    Accept : "application/json",
                    contentType: "application/json",
                    success:function(room){
                        //刷新房间ID信息
                        $('#room_id_span').html(room.id)
                        //刷新房间座位数量
                        $('#seat_count_span').html(room.seatCount)
                        //刷新房间卡牌信息
                        for(key in room.cards){
                            $('#card_div').append('<div>' + getCardName(room.cards[key]) + '</div>')
                        }
                        //刷新房间牌垛信息
                        for(i=1;i<=3;i++){
                            $('#deck_div').append('<div>扣着的牌' + i + '</div>')
                        }
                        //进入房间，并刷新房间玩家信息
                        $.ajax({
                            url: '/onk/' + room.id + '/join',
                            Accept: 'application/json',
                            contentType: 'application/json',
                            success: function(players){
                                console.log("seat at: " + JSON.stringify(players))
                                for(key in players){
                                    var player = players[key];
                                    $('#player_div').append('<div>' + key + '. ' + players[key] + '</div>')
                                }
                            }, error: function(ex){
                                console.log(ex)
                            }
                        })

                        console.log("create room: " + JSON.stringify(room));
                    },
                    error:function(ex){
                        console.log("Bad thing happend! " + ex.statusText);
                    }
                });

            })
            //确定加入
            $('#apply_join_button').click(function(){
                $('#create_join_div').hide()
            })
            //刷新用户信息


        })

        //获得卡牌中文名称
        function getCardName(card){
            if(card == 'WEREWOLF_1'){
                return '狼人'
            }else if(card == 'WEREWOLF_2'){
                return '狼人'
            }else if(card == 'MINION'){
                return '爪牙'
            }else if(card == 'MASON_1'){
                return '守夜人'
            }else if(card == 'MASON_2'){
                return '守夜人'
            }else if(card == 'ROBBER'){
                return '酒鬼'
            }else if(card == 'SEER'){
                return '预言家'
            }else if(card == 'TANNER'){
                return '皮匠'
            }else if(card == 'TROUBLEMAKER'){
                return '捣蛋鬼'
            }else if(card == 'VILLAGER_1'){
                return '村民'
            }else if(card == 'VILLAGER_2'){
                return '村民'
            }else if(card == 'VILLAGER_3'){
                return '村民'
            }else if(card == 'DRUNK'){
                return '酒鬼'
            }else if(card == 'HUNTER'){
                return '猎人'
            }else if(card == 'INSOMNIAC'){
                return '失眠者'
            }else{
                return card
            }
        }
    </script>
</head>
<body>
    <div id="create_join_div" class="container">
        <div id="create_join_button_div" class="row">
            <button id="create_room_button">创建</button>
            <button id="join_room_button">加入</button><br><br>
        </div>
        <div id="create_room_div" class="col-md-5" hidden>
            <div>
                <div>
                    <div>狼人阵营:</div><br>
                    <div style="margin-left:50px">
                        <input id="cb_werewolf_1" type="checkbox" value="WEREWOLF_1" checked>
                        <label for="cb_werewolf_1">狼人</label>
                        <input id="cb_werewolf_2" type="checkbox" value="WEREWOLF_2" checked>
                        <label for="cb_werewolf_2">狼人</label>
                        <input id="minion" type="checkbox" value="MINION" checked>
                        <label for="minion">爪牙</label>
                    </div><br>
                </div>
                <div>
                    <div>村民阵营:</div><br>
                    <div style="margin-left:50px">
                        <input id="cb_mason_1" type="checkbox" value="MASON_1" checked>
                        <label for="cb_mason_1">守夜人</label>
                        <input id="cb_mason_2" type="checkbox" value="MASON_2" checked>
                        <label for="cb_mason_2">守夜人</label>
                    </div><br>
                    <div style="margin-left:50px">
                        <input id="cb_seer" type="checkbox" value="SEER" checked>
                        <label for="cb_seer">预言家</label>
                        <input id="cb_robber" type="checkbox" value="ROBBER" checked>
                        <label for="cb_robber">盗贼</label>
                        <input id="cb_troublemaker" type="checkbox" value="TROUBLEMAKER" checked>
                        <label for="cb_troublemaker">捣蛋鬼</label>
                    </div><br>
                    <div style="margin-left:50px">
                        <input id="cb_drunk" type="checkbox" value="DRUNK" checked>
                        <label for="cb_drunk">酒鬼</label>
                        <input id="cb_insomniac" type="checkbox" value="INSOMNIAC" checked>
                        <label for="cb_insomniac">失眠者</label>
                        <input id="cb_hunter" type="checkbox" value="HUNTER">
                        <label for="cb_hunter">猎人</label>
                    </div><br>
                    <div style="margin-left:50px">
                        <input id="cb_villager_1" type="checkbox" value="VILLAGER_1">
                        <label for="cb_villager_1">村民</label>
                        <input id="cb_villager_2" type="checkbox" value="VILLAGER_2">
                        <label for="cb_villager_2">村民</label>
                        <input id="cb_villager_3" type="checkbox" value="VILLAGER_3">
                        <label for="cb_villager_3">村民</label>
                    </div><br>
                </div>
                <div>
                    <div>皮匠阵营:</div><br>
                    <div style="margin-left:50px">
                        <input id="cb_tanner" type="checkbox" value="TANNER">
                        <label for="cb_tanner">皮匠</label>
                    </div>
                </div>
            </div>
            <button id="apply_create_button" style="margin-left: 200px">确定</button>
        </div>
        <div id="join_room_div" class="row" hidden>
            <label for="room_id_input">房间号: </label>
            <input type="number" id="room_id_input" value="1"><br><br>
            <button id="apply_join_button" style="margin-left: 200px">确定</button>
        </div>
    </div>
    <div id="room_div" class="container" hidden>
        <div id="room_info_div" class="row">
            <label class="col-md-3">房间号: <span id="room_id_span"></span></label>
            <label class="col-md-3">座位数: <span id="seat_count_span"></span></label>
        </div>

        <div class="row">
            <div id="player_div" class="col-sm-4 col-lg-4 col-md-4 col-xs-4">
                玩家信息:
            </div>
            <div id="deck_div" class="col-sm-4 col-lg-4 col-md-4 col-xs-4">
                桌上信息:
            </div>
            <div id="card_div" class="col-sm-4 col-lg-4 col-md-4 col-xs-4">
                卡牌信息:

            </div>
        </div>
    </div>
</body>
</html>
